# General

mode: rule
log-level: warning
profile:
  store-selected: true
  store-fake-ip: false
geodata-mode: true
geo-auto-update: true
geo-update-interval: 24
geox-url:
    geoip: https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geoip.dat
    geosite: https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geosite.dat
global-ua: clash.meta
find-process-mode: strict
routing-mark: 6152
tcp-concurrent: true

# External Controller

external-controller: 0.0.0.0:9090
external-controller-tls: 0.0.0.0:9091
external-controller-cors:
  allow-origins:
    - '*'
  allow-private-network: true
# secret: {{ .secrets.CLASH_AUTHENTICATION }}

# Lan

allow-lan: true
bind-address: "*"
authentication:
  - "chao:{{ .secrets.CLASH_AUTHENTICATION }}"
skip-auth-prefixes:
  - 127.0.0.1/8
  - 10.0.0.0/8
  - 172.16.0.0/12
  - 192.168.0.0/16
  - 100.64.0.0/10
  - ::1/128
  - fd7a:115c:a1e0::/48

# Proxy Settings

# port: 8080
socks-port: 1080
mixed-port: 8080
redir-port: 8081
tproxy-port: 8082
ipv6: true
unified-delay: true

# Tun

tun:
  enable: false
  stack: mixed
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
  strict-route: false
  device: mihomo
  dns-hijack:
    - any:53
    - tcp://any:53
  exclude-interface:
    - Tailscale
    - tailscale0
  route-exclude-address:
    - 100.64.0.0/10
    - fd7a:115c:a1e0::/48

# DNS

dns:
  enable: true
  enhanced-mode: fake-ip
  nameserver:
    - system
    - https://dns.alidns.com/dns-query
    - https://dns.cloudflare.com/dns-query
    - https://dns.google/dns-query
  default-nameserver:
    - 1.1.1.1
    - 8.8.8.8
    - 223.5.5.5
  cache-algorithm: arc
  prefer-h3: true
  use-hosts: true
  use-system-hosts: false
  respect-rules: false
  listen: 0.0.0.0:1053
  ipv6: true
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter-mode: blacklist
  fake-ip-filter:
    - "+.lan"
    - "+.argotunnel.com"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - "localhost.ptlogin2.qq.com"
    - "nmcheck.gnome.org"
    - "nominatim.gnome.org"
    - "location.services.mozilla.com"
    - "ping.archlinux.org"
  nameserver-policy:
    "+.arpa": "10.0.0.1"
    "*.ts.net": "100.100.100.100"
    "rule-set:ğŸŸ¢ Direct":
      - https://dns.alidns.com/dns-query
  fallback:
    - https://doh.pub/dns-query
    - tls://1.1.1.1
    - tls://8.8.8.8
  proxy-server-nameserver:
    - 1.1.1.1
    - 8.8.8.8
  direct-nameserver:
    - system
    - 223.5.5.5
  direct-nameserver-follow-policy: true
  fallback-filter:
    geoip: true
    geoip-code: CN
    nameserver-policy:
      - gfw
    ipcidr:
      - 240.0.0.0/4
    domain:
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'
hosts:
  '*.ts.net': '100.100.100.100'

# Sniffer

sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: false
  sniff:
    HTTP:
      ports: [80]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - 'Mijia Cloud'
    - 'dlg.io.mi.com'
    - '+.apple.com'
  force-domain:
    - 'google.com'

# Proxies

proxy-providers:
  ğŸ³ï¸â€ğŸŒˆ General:
    type: http
    url: https://proxies.er-meng.com{{ .secrets.SUB_STORE_FRONTEND_BACKEND_PATH }}/download/collection/General?target=ClashMeta
    path: ./proxy-providers/General
    interval: 3600
    proxy: ğŸŸ¢ Direct
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true
      expected-status: 204
  ğŸ‡­ğŸ‡° HK:
    type: http
    url: https://proxies.er-meng.com{{ .secrets.SUB_STORE_FRONTEND_BACKEND_PATH }}/download/collection/HK?target=ClashMeta
    path: ./proxy-providers/HK
    interval: 3600
    proxy: ğŸŸ¢ Direct
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true
      expected-status: 204
  ğŸ‡¹ğŸ‡¼ TW:
    type: http
    url: https://proxies.er-meng.com{{ .secrets.SUB_STORE_FRONTEND_BACKEND_PATH }}/download/collection/TW?target=ClashMeta
    path: ./proxy-providers/TW
    interval: 3600
    proxy: ğŸŸ¢ Direct
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true
      expected-status: 204
  ğŸ‡¯ğŸ‡µ JP:
    type: http
    url: https://proxies.er-meng.com{{ .secrets.SUB_STORE_FRONTEND_BACKEND_PATH }}/download/collection/JP?target=ClashMeta
    path: ./proxy-providers/JP
    interval: 3600
    proxy: ğŸŸ¢ Direct
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true
      expected-status: 204
  ğŸ‡¸ğŸ‡¬ SG:
    type: http
    url: https://proxies.er-meng.com{{ .secrets.SUB_STORE_FRONTEND_BACKEND_PATH }}/download/collection/SG?target=ClashMeta
    path: ./proxy-providers/SG
    interval: 3600
    proxy: ğŸŸ¢ Direct
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true
      expected-status: 204
  ğŸ‡ºğŸ‡¸ US:
    type: http
    url: https://proxies.er-meng.com{{ .secrets.SUB_STORE_FRONTEND_BACKEND_PATH }}/download/collection/US?target=ClashMeta
    path: ./proxy-providers/US
    interval: 3600
    proxy: ğŸŸ¢ Direct
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true
      expected-status: 204
  ğŸ‡²ğŸ‡¾ MY:
    type: http
    url: https://proxies.er-meng.com{{ .secrets.SUB_STORE_FRONTEND_BACKEND_PATH }}/download/collection/MY?target=ClashMeta
    path: ./proxy-providers/MY
    interval: 3600
    proxy: ğŸŸ¢ Direct
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true
      expected-status: 204
  ğŸ‡¦ğŸ‡· AR:
    type: http
    url: https://proxies.er-meng.com{{ .secrets.SUB_STORE_FRONTEND_BACKEND_PATH }}/download/collection/AR?target=ClashMeta
    path: ./proxy-providers/AR
    interval: 3600
    proxy: ğŸŸ¢ Direct
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true
      expected-status: 204
  ğŸ‡¹ğŸ‡· TR:
    type: http
    url: https://proxies.er-meng.com{{ .secrets.SUB_STORE_FRONTEND_BACKEND_PATH }}/download/collection/TR?target=ClashMeta
    path: ./proxy-providers/TR
    interval: 3600
    proxy: ğŸŸ¢ Direct
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true
      expected-status: 204

proxies:
  - name: "ğŸŸ¢ Direct"
    type: direct
  - name: "ğŸ”´ Reject"
    type: reject

proxy-groups:
  - name: "ğŸŒ Proxy"
    type: select
    proxies:
      - "âš¡ï¸ Auto"
      - "ğŸ‡­ğŸ‡° HK"
      - "ğŸ‡¹ğŸ‡¼ TW"
      - "ğŸ‡¯ğŸ‡µ JP"
      - "ğŸ‡¸ğŸ‡¬ SG"
      - "ğŸ‡ºğŸ‡¸ US"
      - "ğŸ‡²ğŸ‡¾ MY"
      - "ğŸ‡¦ğŸ‡· AR"
      - "ğŸ‡¹ğŸ‡· TR"
  - name: "âš¡ï¸ Auto"
    type: url-test
    use:
      - ğŸ³ï¸â€ğŸŒˆ General
    url: "https://www.gstatic.com/generate_204"
    interval: 300
  - name: "ğŸ§  AI"
    type: select
    proxies:
      - "ğŸŒ Proxy"
      - "ğŸŸ¢ Direct"
      - "âš¡ï¸ Auto"
      - "ğŸ‡¹ğŸ‡¼ TW"
      - "ğŸ‡¯ğŸ‡µ JP"
      - "ğŸ‡¸ğŸ‡¬ SG"
      - "ğŸ‡ºğŸ‡¸ US"
      - "ğŸ‡²ğŸ‡¾ MY"
      - "ğŸ‡¦ğŸ‡· AR"
      - "ğŸ‡¹ğŸ‡· TR"
  - name: "ğŸ® Game"
    type: select
    proxies:
      - "ğŸŒ Proxy"
      - "ğŸŸ¢ Direct"
      - "âš¡ï¸ Auto"
      - "ğŸ‡­ğŸ‡° HK"
      - "ğŸ‡¹ğŸ‡¼ TW"
      - "ğŸ‡¯ğŸ‡µ JP"
      - "ğŸ‡¸ğŸ‡¬ SG"
      - "ğŸ‡ºğŸ‡¸ US"
      - "ğŸ‡²ğŸ‡¾ MY"
      - "ğŸ‡¦ğŸ‡· AR"
      - "ğŸ‡¹ğŸ‡· TR"
  - name: "ğŸ“º Media"
    type: select
    proxies:
      - "ğŸŒ Proxy"
      - "ğŸŸ¢ Direct"
      - "âš¡ï¸ Auto"
      - "ğŸ‡­ğŸ‡° HK"
      - "ğŸ‡¹ğŸ‡¼ TW"
      - "ğŸ‡¯ğŸ‡µ JP"
      - "ğŸ‡¸ğŸ‡¬ SG"
      - "ğŸ‡ºğŸ‡¸ US"
      - "ğŸ‡²ğŸ‡¾ MY"
      - "ğŸ‡¦ğŸ‡· AR"
      - "ğŸ‡¹ğŸ‡· TR"
  - name: "ğŸŸ Final"
    type: select
    proxies:
      - "ğŸŒ Proxy"
      - "ğŸŸ¢ Direct"
      - "âš¡ï¸ Auto"
      - "ğŸ‡­ğŸ‡° HK"
      - "ğŸ‡¹ğŸ‡¼ TW"
      - "ğŸ‡¯ğŸ‡µ JP"
      - "ğŸ‡¸ğŸ‡¬ SG"
      - "ğŸ‡ºğŸ‡¸ US"
      - "ğŸ‡²ğŸ‡¾ MY"
      - "ğŸ‡¦ğŸ‡· AR"
      - "ğŸ‡¹ğŸ‡· TR"
  - name: "ğŸ‡­ğŸ‡° HK"
    type: url-test
    use:
      - ğŸ‡­ğŸ‡° HK
    url: "https://www.gstatic.com/generate_204"
    interval: 300
  - name: "ğŸ‡¹ğŸ‡¼ TW"
    type: url-test
    use:
      - ğŸ‡¹ğŸ‡¼ TW
    url: "https://www.gstatic.com/generate_204"
    interval: 300
  - name: "ğŸ‡¯ğŸ‡µ JP"
    type: url-test
    use:
      - ğŸ‡¯ğŸ‡µ JP
    url: "https://www.gstatic.com/generate_204"
    interval: 300
  - name: "ğŸ‡¸ğŸ‡¬ SG"
    type: url-test
    use:
      - ğŸ‡¸ğŸ‡¬ SG
    url: "https://www.gstatic.com/generate_204"
    interval: 300
  - name: "ğŸ‡ºğŸ‡¸ US"
    type: url-test
    use:
      - ğŸ‡ºğŸ‡¸ US
    url: "https://www.gstatic.com/generate_204"
    interval: 300
  - name: "ğŸ‡²ğŸ‡¾ MY"
    type: url-test
    use:
      - ğŸ‡²ğŸ‡¾ MY
    url: "https://www.gstatic.com/generate_204"
    interval: 300
  - name: "ğŸ‡¦ğŸ‡· AR"
    type: url-test
    use:
      - ğŸ‡¦ğŸ‡· AR
    url: "https://www.gstatic.com/generate_204"
    interval: 300
  - name: "ğŸ‡¹ğŸ‡· TR"
    type: url-test
    use:
      - ğŸ‡¹ğŸ‡· TR
    url: "https://www.gstatic.com/generate_204"
    interval: 300

rules:
  # ğŸš« AD
  - RULE-SET,advertising,ğŸ”´ Reject
  - RULE-SET,zhihu_ads,ğŸ”´ Reject
  - RULE-SET,hijacking,ğŸ”´ Reject
  - RULE-SET,privacy,ğŸ”´ Reject

  # ğŸ§  AI
  - RULE-SET,ai_chao,ğŸ§  AI
  - RULE-SET,claude,ğŸ§  AI
  - RULE-SET,copilot,ğŸ§  AI
  - RULE-SET,gemini,ğŸ§  AI
  - RULE-SET,openai,ğŸ§  AI

  # ğŸŸ¢ Direct
  - RULE-SET,direct_chao,ğŸŸ¢ Direct
  - RULE-SET,apple,ğŸŸ¢ Direct
  - RULE-SET,china_max,ğŸŸ¢ Direct
  - RULE-SET,download,ğŸŸ¢ Direct
  - RULE-SET,lan,ğŸŸ¢ Direct

  # ğŸ® Game
  - RULE-SET,game_chao,ğŸ® Game
  - RULE-SET,game,ğŸ® Game

  # ğŸ“º Media
  - RULE-SET,disney,ğŸ“º Media
  - RULE-SET,netflix,ğŸ“º Media
  - RULE-SET,hbo_usa,ğŸ“º Media
  - RULE-SET,spotify,ğŸ“º Media
  - RULE-SET,tiktok,ğŸ“º Media
  - RULE-SET,youtube,ğŸ“º Media
  - RULE-SET,youtube_music,ğŸ“º Media

  # ğŸŒ Proxy
  - RULE-SET,proxy_chao,ğŸŒ Proxy
  - RULE-SET,developer,ğŸŒ Proxy
  - RULE-SET,google,ğŸŒ Proxy
  - RULE-SET,github,ğŸŒ Proxy

  # IP
  - GEOIP, CN, ğŸŸ¢ Direct
  - RULE-SET,amazon_cloud,ğŸŒ Proxy, no-resolve

  - MATCH,ğŸŸ Final

rule-providers:
  # ğŸš« AD
  advertising:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Advertising/Advertising.yaml
    path: ./rule-providers/AD/advertising.yaml
    interval: 86400

  zhihu_ads:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ZhihuAds/ZhihuAds.yaml
    path: ./rule-providers/AD/zhihu_ads.yaml
    interval: 86400

  hijacking:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Hijacking/Hijacking.yaml
    path: ./rule-providers/AD/hijacking.yaml
    interval: 86400

  privacy:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Privacy/Privacy.yaml
    path: ./rule-providers/AD/privacy.yaml
    interval: 86400

  # ğŸ§  AI
  ai_chao:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/ermengchao/proxy_rule_script/main/rule/Clash/AI/AI.yaml
    path: ./rule-providers/AI/ai_chao.yaml
    interval: 86400

  claude:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Claude/Claude.yaml
    path: ./rule-providers/AI/claude.yaml
    interval: 86400
    
  copilot:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Copilot/Copilot.yaml
    path: ./rule-providers/AI/copilot.yaml
    interval: 86400

  gemini:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Gemini/Gemini.yaml
    path: ./rule-providers/AI/gemini.yaml
    interval: 86400

  openai:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml
    path: ./rule-providers/AI/openai.yaml
    interval: 86400

  # ğŸŸ¢ Direct
  direct_chao:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/ermengchao/proxy_rule_script/main/rule/Clash/Direct/Direct.yaml
    path: ./rule-providers/Direct/direct_chao.yaml
    interval: 86400

  apple:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Apple/Apple.yaml
    path: ./rule-providers/Direct/apple.yaml
    interval: 86400

  china_max:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ChinaMax/ChinaMax.yaml
    path: ./rule-providers/Direct/china_max.yaml
    interval: 86400

  download:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Download/Download.yaml
    path: ./rule-providers/Direct/download.yaml
    interval: 86400

  lan:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan.yaml
    path: ./rule-providers/Direct/lan.yaml
    interval: 86400

  # ğŸ® Game
  game_chao:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/ermengchao/proxy_rule_script/main/rule/Clash/Game/Game.yaml
    path: ./rule-providers/Game/game_chao.yaml
    interval: 86400

  game:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Game/Game.yaml
    path: ./rule-providers/Game/game.yaml
    interval: 86400

  # ğŸ“º Media
  disney:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Disney/Disney.yaml
    path: ./rule-providers/Media/disney.yaml
    interval: 86400

  netflix:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Netflix/Netflix.yaml
    path: ./rule-providers/Media/netflix.yaml
    interval: 86400

  hbo_usa:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/HBOUSA/HBOUSA.yaml
    path: ./rule-providers/Media/hbo_usa.yaml
    interval: 86400

  spotify:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Spotify/Spotify.yaml
    path: ./rule-providers/Media/spotify.yaml
    interval: 86400

  tiktok:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/TikTok/TikTok.yaml
    path: ./rule-providers/Media/tiktok.yaml
    interval: 86400

  youtube:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml
    path: ./rule-providers/Media/youtube.yaml
    interval: 86400

  youtube_music:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTubeMusic/YouTubeMusic.yaml
    path: ./rule-providers/Media/youtube_music.yaml
    interval: 86400

  # ğŸŒ Proxy
  proxy_chao:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/ermengchao/proxy_rule_script/main/rule/Clash/Proxy/Proxy.yaml
    path: ./rule-providers/Proxy/proxy_chao.yaml
    interval: 86400

  developer:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Developer/Developer.yaml
    path: ./rule-providers/Proxy/developer.yaml
    interval: 86400

  amazon_cloud:
    type: http
    behavior: ipcidr
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Cloud/AmazonCloud/AmazonCloud_IP.yaml
    path: ./rule-providers/Proxy/amazon_cloud.yaml
    interval: 86400

  google:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.yaml
    path: ./rule-providers/Proxy/google.yaml
    interval: 86400

  github:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub.yaml
    path: ./rule-providers/Proxy/github.yaml
    interval: 86400
