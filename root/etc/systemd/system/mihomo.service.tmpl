[Unit]
Description=mihomo Daemon, Another Clash Kernel.
After=network.target NetworkManager.service systemd-networkd.service iwd.service

[Service]
Type=simple
LimitNPROC=500
LimitNOFILE=1000000
CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_RAW CAP_NET_BIND_SERVICE CAP_SYS_TIME CAP_SYS_PTRACE CAP_DAC_READ_SEARCH CAP_DAC_OVERRIDE
AmbientCapabilities=CAP_NET_ADMIN CAP_NET_RAW CAP_NET_BIND_SERVICE CAP_SYS_TIME CAP_SYS_PTRACE CAP_DAC_READ_SEARCH CAP_DAC_OVERRIDE
Restart=on-failure
ExecStartPre=/usr/bin/sleep 1s
{{ if eq .chezmoi.version.builtBy "Homebrew" -}}
ExecStart="/home/linuxbrew/.linuxbrew/opt/mihomo/bin/mihomo" -d "/home/chao/.config/mihomo"
{{ else -}}
ExecStart="/usr/bin/mihomo" -d "/home/chao/.config/mihomo"
{{ end -}}
ExecReload=/bin/kill -HUP $MAINPID
StandardOutput=journal
StandardError=journal
RuntimeMaxSec=86400

[Install]
WantedBy=multi-user.target
